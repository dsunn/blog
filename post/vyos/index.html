<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Vyos | Whatever blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Article description.">
    <meta name="generator" content="Hugo 0.145.0">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/blog/ananke/css/main.min.d05fb5f317fcf33b3a52936399bdf6f47dc776516e1692e412ec7d76f4a5faa2.css" >




    

    
      

    

    

    
      <link rel="canonical" href="https://dsunn.github.io/blog/post/vyos/">
    

    <meta property="og:url" content="https://dsunn.github.io/blog/post/vyos/">
  <meta property="og:site_name" content="Whatever blog">
  <meta property="og:title" content="Vyos">
  <meta property="og:description" content="Article description.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-03-22T14:18:21+08:00">
    <meta property="article:modified_time" content="2025-03-22T14:18:21+08:00">
    <meta property="article:tag" content="Vyos">
    <meta property="article:tag" content="Router">

  <meta itemprop="name" content="Vyos">
  <meta itemprop="description" content="Article description.">
  <meta itemprop="datePublished" content="2025-03-22T14:18:21+08:00">
  <meta itemprop="dateModified" content="2025-03-22T14:18:21+08:00">
  <meta itemprop="wordCount" content="1703">
  <meta itemprop="keywords" content="Vyos,Router">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Vyos">
  <meta name="twitter:description" content="Article description.">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/blog/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Whatever blog
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Vyos</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2025-03-22T14:18:21+08:00">March 22, 2025</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>vyos的命令行界面是基于shell的，没有图形界面, 但是可以用tab自动补全.
本文的vyos命令是基于vyos的vyos-rolling-nightly-builds的1.5.x版本.</p>
<p>pve安装vyos:
下载nightly-build: <a href="https://github.com/vyos/vyos-nightly-build/releases">https://github.com/vyos/vyos-nightly-build/releases</a>
pve的虚拟机设置和安装(略), 建议内存2G, 磁盘10G或更大, 因为vyos可以运行容器, vyos用podman管理容器.</p>
<p>vm运行后, 用vyos:vyos登录. 用命令</p>
<pre tabindex="0"><code>install image
</code></pre><p>安装vyos.</p>
<p>设置ssh登录:</p>
<pre tabindex="0"><code>set service ssh port &#39;22&#39;
</code></pre><p>创建用户dave:</p>
<pre tabindex="0"><code>set system login user dave full-name dave
set system login user dave authentication plaintext-password &#39;your-password&#39;
</code></pre><p>建议ssh密钥登录:</p>
<pre tabindex="0"><code>set system login user dave authentication public-keys dave@laptop key &#39;your-public-key&#39;
set system login user dave authentication public-keys dave@laptop type &#39;ssh-rsa&#39;
</code></pre><p>禁用默认的vyos用户:</p>
<pre tabindex="0"><code>set system login user vyos disable
</code></pre><p>设置系统的hostname:</p>
<pre tabindex="0"><code>set system host-name &#39;vyos&#39;
</code></pre><p>设置时区:</p>
<pre tabindex="0"><code>set system time-zone &#39;Asia/Shanghai&#39;
</code></pre><p>设置ntp:</p>
<pre tabindex="0"><code>set service ntp server 129.250.35.251
set service ntp server 203.107.6.88
</code></pre><p>(注: 可以设置多个ntp服务器, 建议用运营商的ntp服务器, 最好是纯ip, 可删除默认的ntp服务器)</p>
<p>设置网络接口:</p>
<p>设:eth0是lan口, eth1是wan口</p>
<p>设置接口组(可选但建议):</p>
<pre tabindex="0"><code>set firewall group interface-group LAN interface &#39;eth0&#39;
set firewall group interface-group WAN interface &#39;eth1&#39;
</code></pre><p>设置网络组(可选):</p>
<pre tabindex="0"><code>set firewall group network-group LAN-v4 network &#39;192.168.10.0/24&#39;
</code></pre><p>设置接口ip:</p>
<pre tabindex="0"><code>set interfaces ethernet eth0 address 192.168.10.1/24
set interfaces ethernet eth1 address dhcp
</code></pre><p>当eth1是pppoe时:</p>
<pre tabindex="0"><code>set interfaces pppoe pppoe1 authentication password &#39;your-password&#39;
set interfaces pppoe pppoe1 authentication username &#39;your-username&#39;
set interfaces pppoe pppoe1 mtu &#39;1492&#39;
set interfaces pppoe pppoe1 ip adjust-mss &#39;clamp-mss-to-pmtu&#39;
set interfaces pppoe pppoe1 service-interface &#39;eth1&#39;
set interfaces pppoe pppoe1 no-default-route
</code></pre><p>(注: 当设置no-default-route时, 需要在后面指定静态路由, 或者也可不设置no-default-route这条, vyos会自动添加默认路由)</p>
<p>设置pppoe获取ipv6, 并配置Prefix Delegation和RA:
(注: 本文ipv6, 采用slacc, 但ipv6访问路由器后面的服务, 采用DNAT, NAT66, 对外的ipv6连接, 不NAT)</p>
<pre tabindex="0"><code>set interfaces pppoe pppoe1 dhcpv6-options pd 0 interface eth0 address &#39;1&#39;
set interfaces pppoe pppoe1 dhcpv6-options pd 0 length &#39;56&#39;
set interfaces pppoe pppoe1 ipv6 adjust-mss &#39;clamp-mss-to-pmtu&#39;
set interfaces ethernet eth0 ipv6 address autoconf
set service router-advert interface eth0 prefix ::/64
</code></pre><p>配置lan口的Unique Local Address:</p>
<pre tabindex="0"><code>set interfaces ethernet eth0 address &#39;fd00::1/64&#39; 
</code></pre><p>设置dns:</p>
<pre tabindex="0"><code>set system name-server &#39;223.5.5.5&#39;
set service dns forwarding cache-size &#39;0&#39;
set service dns forwarding dhcp &#39;pppoe1&#39; #dhcp获取ISP的dns
set service dns forwarding listen-address &#39;192.168.10.1&#39; #lan口的ip
set service dns forwarding system
</code></pre><p>设置出Wan口的默认静态路由:</p>
<pre tabindex="0"><code>set protocols static route 0.0.0.0/0 interface pppoe1
set protocols static route6 ::/0 interface pppoe1
</code></pre><p>(注: 前面设置了no-default-route, 所以这里需要设置默认路由)</p>
<p>设置防火墙:
设置masquerade(SNAT):</p>
<pre tabindex="0"><code>set nat source rule 100 translation address &#39;masquerade&#39;
</code></pre><p>这里防火墙rule <!-- raw HTML omitted --> 数字可自定, 同一数字为一组, 建议设置数字时, 留出空隙, 以便以后添加新的规则.
针对上面这条nat source rule 100 规则, 建议不要限制接口, 就只用上面一条, 这对以后的端口转发和回流设置, 都很方便.</p>
<p>设置端口转发(DNAT):</p>
<pre tabindex="0"><code>set nat destination rule 10 description &#39;DSTNAT-wg&#39;
set nat destination rule 10 destination port &#39;53822&#39;
set nat destination rule 10 inbound-interface group &#39;WAN&#39; #可用interface eth1代替
set nat destination rule 10 protocol &#39;udp&#39;
set nat destination rule 10 translation address &#39;192.168.10.145&#39;
set nat destination rule 10 translation port &#39;53822&#39; #可省略, 如果端口相同
</code></pre><p>设置回流:
由于上面masquerade(SNAT)的规则, 这里不需要设置回流.</p>
<p>设置防火墙规则:
设置ipv4入站(input链)规则:</p>
<pre tabindex="0"><code>set firewall ipv4 name WAN_LOCAL default-action &#39;drop&#39; #默认拒绝
set firewall ipv4 name WAN_LOCAL rule 10 action &#39;accept&#39; #允许已建立和相关连接
set firewall ipv4 name WAN_LOCAL rule 10 state &#39;established&#39;
set firewall ipv4 name WAN_LOCAL rule 10 state &#39;related&#39;
set firewall ipv4 name WAN_LOCAL rule 20 action &#39;accept&#39; #允许连接wg0
set firewall ipv4 name WAN_LOCAL rule 20 destination port &#39;11133&#39; 
set firewall ipv4 name WAN_LOCAL rule 20 protocol &#39;udp&#39;
set firewall ipv4 name WAN_LOCAL rule 30 action &#39;accept&#39; #允许icmp
set firewall ipv4 name WAN_LOCAL rule 30 protocol &#39;icmp&#39;
</code></pre><p>设置ipv6入站(input链)规则:</p>
<pre tabindex="0"><code>set firewall ipv6 name WAN_LOCAL default-action &#39;drop&#39; #默认拒绝
set firewall ipv6 name WAN_LOCAL rule 10 action &#39;accept&#39; #允许已建立和相关连接
set firewall ipv6 name WAN_LOCAL rule 10 state &#39;established&#39;
set firewall ipv6 name WAN_LOCAL rule 10 state &#39;related&#39;
set firewall ipv6 name WAN_LOCAL rule 20 action &#39;accept&#39; #允许icmpv6
set firewall ipv6 name WAN_LOCAL rule 20 protocol &#39;icmpv6&#39;
set firewall ipv6 name WAN_LOCAL rule 30 action &#39;accept&#39; #允许从ISP处获取的dhcp6的信息
set firewall ipv6 name WAN_LOCAL rule 30 destination port &#39;546&#39;
set firewall ipv6 name WAN_LOCAL rule 30 protocol &#39;udp&#39;
set firewall ipv6 name WAN_LOCAL rule 30 source port &#39;547&#39;
set firewall ipv6 name WAN_LOCAL rule 40 action &#39;accept&#39; #允许连接wg0
set firewall ipv6 name WAN_LOCAL rule 40 destination port &#39;11133&#39;
set firewall ipv6 name WAN_LOCAL rule 40 protocol &#39;udp&#39;
</code></pre><p>设置ipv4转发(forward链)规则:</p>
<pre tabindex="0"><code>set firewall ipv4 name WAN_IN default-action &#39;drop&#39; #默认拒绝
set firewall ipv4 name WAN_IN rule 10 action &#39;accept&#39; #允许已建立和相关连接
set firewall ipv4 name WAN_IN rule 10 state &#39;established&#39;
set firewall ipv4 name WAN_IN rule 10 state &#39;related&#39;
set firewall ipv4 name WAN_IN rule 20 action &#39;accept&#39; #允许已DNAT的连接
set firewall ipv4 name WAN_IN rule 20 connection-status nat &#39;destination&#39;
set firewall ipv4 name WAN_IN rule 20 state &#39;new&#39;
</code></pre><p>设置ipv6转发(forward链)规则:</p>
<pre tabindex="0"><code>set firewall ipv6 name WAN_IN default-action &#39;drop&#39; #默认拒绝
set firewall ipv6 name WAN_IN rule 10 action &#39;accept&#39; #允许已建立和相关连接
set firewall ipv6 name WAN_IN rule 10 state &#39;established&#39;
set firewall ipv6 name WAN_IN rule 10 state &#39;related&#39;
set firewall ipv6 name WAN_IN rule 20 action &#39;accept&#39; #允许icmpv6
set firewall ipv6 name WAN_IN rule 20 protocol &#39;icmpv6&#39;
set firewall ipv6 name WAN_IN rule 30 action &#39;accept&#39; #允许ipsec
set firewall ipv6 name WAN_IN rule 30 destination port &#39;500,4500&#39;
set firewall ipv6 name WAN_IN rule 30 protocol &#39;udp&#39;
</code></pre><p>然后分别从input和forward链, 调用WAN_LOCAL和WAN_IN:</p>
<pre tabindex="0"><code>set firewall ipv4 input filter rule 10 action &#39;jump&#39;
set firewall ipv4 input filter rule 10 inbound-interface group &#39;WAN&#39;
set firewall ipv4 input filter rule 10 jump-target &#39;WAN_LOCAL&#39;

set firewall ipv4 forward filter rule 10 action &#39;jump&#39;
set firewall ipv4 forward filter rule 10 inbound-interface group &#39;WAN&#39;
set firewall ipv4 forward filter rule 10 jump-target &#39;WAN_IN&#39;

set firewall ipv6 input filter rule 10 action &#39;jump&#39;
set firewall ipv6 input filter rule 10 inbound-interface group &#39;WAN&#39;
set firewall ipv6 input filter rule 10 jump-target &#39;WAN_LOCAL&#39;

set firewall ipv6 forward filter rule 10 action &#39;jump&#39;
set firewall ipv6 forward filter rule 10 inbound-interface group &#39;WAN&#39;
set firewall ipv6 forward filter rule 10 jump-target &#39;WAN_IN&#39;
</code></pre><p>注: DNAT是流量进入后, 最先处理的, 然后进入forward链, 而SNAT是流量出站前, 最后处理的.</p>
<p>配置wireguard:</p>
<pre tabindex="0"><code>set interfaces wireguard wg0 address &#39;10.20.20.1/24&#39;
set interfaces wireguard wg0 peer iphone allowed-ips &#39;10.200.200.2/32&#39;
set interfaces wireguard wg0 peer iphone preshared-key &#39;preshared-key&#39;
set interfaces wireguard wg0 peer iphone public-key &#39;public-key&#39;
set interfaces wireguard wg0 port &#39;11133&#39;
set interfaces wireguard wg0 private-key &#39;private-key&#39;
</code></pre><p>配置dhcp server:</p>
<pre tabindex="0"><code>set service dhcp-server hostfile-update
set service dhcp-server shared-network-name VYOS subnet 192.168.10.0/24 lease &#39;86400&#39;
set service dhcp-server shared-network-name VYOS subnet 192.168.10.0/24 option default-router &#39;192.168.10.1&#39; #dhcp option 默认网关
set service dhcp-server shared-network-name VYOS subnet 192.168.10.0/24 option name-server &#39;192.168.10.1&#39; #dhcp option dns
set service dhcp-server shared-network-name VYOS subnet 192.168.10.0/24 option ntp-server &#39;192.168.10.1&#39; #dhcp option ntp
set service dhcp-server shared-network-name VYOS subnet 192.168.10.0/24 range 0 start &#39;192.168.10.101&#39;
set service dhcp-server shared-network-name VYOS subnet 192.168.10.0/24 range 0 stop &#39;192.168.10.200&#39;
set service dhcp-server shared-network-name VYOS subnet 192.168.10.0/24 static-mapping alist ip-address &#39;192.168.10.120&#39; #dhcp option 绑定静态ip based on mac
set service dhcp-server shared-network-name VYOS subnet 192.168.10.0/24 static-mapping alist mac &#39;8A:51:26:73:62:FE&#39;
</code></pre><p>配置ddns:
cloudflare ddns:</p>
<pre tabindex="0"><code>set service dns dynamic name DDNS-CF-v4 address interface &#39;pppoe1&#39;
set service dns dynamic name DDNS-CF-v4 host-name &#39;ddns.example.com&#39;
set service dns dynamic name DDNS-CF-v4 ip-version &#39;ipv4&#39;
set service dns dynamic name DDNS-CF-v4 password &#39;token&#39;
set service dns dynamic name DDNS-CF-v4 protocol &#39;cloudflare&#39;
set service dns dynamic name DDNS-CF-v4 zone &#39;example.com&#39;
set service dns dynamic name DDNS-CF-v6 address interface &#39;eth0&#39;
set service dns dynamic name DDNS-CF-v6 host-name &#39;ddns6.example.com&#39;
set service dns dynamic name DDNS-CF-v6 ip-version &#39;ipv6&#39;
set service dns dynamic name DDNS-CF-v6 password &#39;token&#39;
set service dns dynamic name DDNS-CF-v6 protocol &#39;cloudflare&#39;
set service dns dynamic name DDNS-CF-v6 zone &#39;example.com&#39;
</code></pre><p>dnspod ddns:</p>
<pre tabindex="0"><code>set service dns dynamic name DNSPOD-v4 address interface &#39;pppoe1&#39;
set service dns dynamic name DNSPOD-v4 host-name &#39;ddns.example.com&#39;
set service dns dynamic name DNSPOD-v4 password &#39;token&#39;
set service dns dynamic name DNSPOD-v4 protocol &#39;dyndns2&#39;
set service dns dynamic name DNSPOD-v4 server &#39;dnsapi.cn&#39;
set service dns dynamic name DNSPOD-v4 username &#39;id&#39;
</code></pre><p>个人使用下来, 上述配置并不需要设置interval, ip变化也会自动更新.</p>
<p>设置策略路由:
举例: 让wg0的流量走100号路由表, 100号路由表是sb的路由表</p>
<pre tabindex="0"><code>set policy route WG0-to-SB interface &#39;wg0&#39;
set policy route WG0-to-SB rule 10 destination group network-group &#39;!LAN-v4&#39;
set policy route WG0-to-SB rule 10 set table &#39;100&#39;
</code></pre><p>路由表</p>
<pre tabindex="0"><code>set protocols static table 100 route 0.0.0.0/0 next-hop 192.168.10.90
</code></pre><p>对于终端网关是vyos的，通过mosdns来分流realip和fakeip的流量, 可这样配置:
(vyos的group分为address-group,network-group等)</p>
<p>定义组 IP例:</p>
<pre tabindex="0"><code>set firewall group address-group Telegram-v4 address &#39;157.148.47.204&#39;
set firewall group address-group Telegram-v4 address &#39;182.43.124.6&#39;
</code></pre><p>定义组网段V4例：</p>
<pre tabindex="0"><code>set firewall group network-group Telegram-v4 address &#39;91.108.56.0/22&#39;
set firewall group network-group Telegram-v4 address &#39;91.108.4.0/22&#39;
</code></pre><p>定义组telegram V4:</p>
<pre tabindex="0"><code>set firewall group network-group Telegram-v4 network &#39;91.108.56.0/22&#39;
set firewall group network-group Telegram-v4 network &#39;91.108.4.0/22&#39;
set firewall group network-group Telegram-v4 network &#39;91.108.8.0/22&#39;
set firewall group network-group Telegram-v4 network &#39;91.108.16.0/22&#39;
set firewall group network-group Telegram-v4 network &#39;91.108.12.0/22&#39;
set firewall group network-group Telegram-v4 network &#39;149.154.160.0/20&#39;
set firewall group network-group Telegram-v4 network &#39;91.105.192.0/23&#39;
set firewall group network-group Telegram-v4 network &#39;91.108.20.0/22&#39;
set firewall group network-group Telegram-v4 network &#39;185.76.151.0/24&#39;
</code></pre><p>定义组ip-V6例：</p>
<pre tabindex="0"><code>set firewall group ipv6-address-group Telegram-v6 address &#39;2a00:1098:80:2::1004&#39;
set firewall group ipv6-address-group Telegram-v6 address &#39;2a00:1098:80:2::1001&#39;
</code></pre><p>定义组网段V6例：</p>
<pre tabindex="0"><code>set firewall group ipv6-network-group Telegram-v6 network &#39;2001:b28:f23d::/48&#39;
set firewall group ipv6-network-group Telegram-v6 network &#39;2001:b28:f23f::/48&#39;
</code></pre><p>定义组V6 Telegram-V6:</p>
<pre tabindex="0"><code>set firewall group ipv6-network-group Telegram-v6 network &#39;2001:b28:f23d::/48&#39;
set firewall group ipv6-network-group Telegram-v6 network &#39;2001:b28:f23f::/48&#39;
set firewall group ipv6-network-group Telegram-v6 network &#39;2001:67c:4e8::/48&#39;
set firewall group ipv6-network-group Telegram-v6 network &#39;2001:b28:f23c::/48&#39;
set firewall group ipv6-network-group Telegram-v6 network &#39;2a0a:f280::/32&#39;
</code></pre><p>定义组fakeip:</p>
<pre tabindex="0"><code>set firewall group network-group FAKEIP-v4 network &#39;198.18.0.0/15&#39; # fakeip
set firewall group ipv6-network-group FAKEIP-v6 network &#39;f2b0::/18&#39; # fakeip6
</code></pre><p>配置策略路由:(类似ros中mangle部分)</p>
<pre tabindex="0"><code>set policy route Route-to-SB interface &#39;eth0&#39; # eth0是lan口
set policy route Route-to-SB rule 10 set table &#39;100&#39; # table 100是to-sb的表
set policy route Route-to-SB rule 10 destination group network-group &#39;Telegram-v4&#39;
set policy route Route-to-SB rule 20 set table &#39;100&#39; # table 100是to-sb的表
set policy route Route-to-SB rule 20 destination group network-group &#39;FAKEIP-v4&#39;

set policy route6 FAKE6-to-SB interface &#39;eth0&#39;
set policy route6 FAKE6-to-SB rule 10 set table &#39;106&#39; # table 106是to-sb的表 (v6)
set policy route6 FAKE6-to-SB rule 10 destination group ipv6-network-group &#39;FAKEIP-v6&#39;
set policy route6 FAKE6-to-SB rule 20 set table &#39;106&#39; # table 106是to-sb的表 (v6)
set policy route6 FAKE6-to-SB rule 20 destination group ipv6-network-group &#39;Telegram-v6&#39;
</code></pre><p>配置路由表</p>
<pre tabindex="0"><code>set protocols static table 100 route 0.0.0.0/0 next-hop 192.168.100.2 # sb的内网ip
set protocols static table 106 route6 ::/0 next-hop fd88::2222 # sb的ula
</code></pre><p>voys自己如要科学上网, 一般是在pull容器镜像, 下载更新的ios等情形下, 可以这样配置,</p>
<pre tabindex="0"><code>set system name-server &#39;192.168.10.90&#39; # 192.168.10.90是sb的ip, 或mosdns的ip, based on your topology.
</code></pre><p>注意这里的name-server, 只需要一个, 就是能区分fakeip的.</p>
<pre tabindex="0"><code>set policy local-route rule 10 destination group network-group &#39;FAKEIP-v4&#39;
set policy local-route rule 10 protocol &#39;tcp&#39;
set policy local-route rule 10 set table &#39;100&#39;
</code></pre><p>配不配ipv6的local-route, 取决于你的需要, 不配置也行, 因为vyos自己的需要, 较为简单</p>
<hr>
<h2 id="done">done!</h2>
<p>tips:</p>
<ol>
<li>在&rsquo;#&lsquo;状态下 可用run show config, 来运行&rsquo;$&lsquo;状态下的命令</li>
<li>我常用的命令 还有
&lsquo;monitor&rsquo; (&rsquo;$&lsquo;下), 监视动态变化
&lsquo;compare&rsquo; (&rsquo;#&lsquo;下), 未commit前比较edit的变化</li>
</ol>
<p>voys部署容器</p>
<ol>
<li>拉取镜像</li>
</ol>
<pre tabindex="0"><code>add container image &#39;lscr.io/linuxserver/heimdall:latest&#39;
</code></pre><p>或</p>
<pre tabindex="0"><code>sudo podman pull lscr.io/linuxserver/heimdall:latest
</code></pre><p>vyos configure模式下:
2. 创建网络</p>
<p>创建容器网络</p>
<pre tabindex="0"><code>set container network ct-network prefix &#39;172.23.0.0/24&#39; #与宿主网段不同
</code></pre><ol start="3">
<li>创建容器</li>
</ol>
<pre tabindex="0"><code>set container name heimdall environment PGID value &#39;100&#39;
set container name heimdall environment PUID value &#39;1002&#39;
set container name heimdall environment TZ value &#39;Asia/Shanghai&#39;
set container name heimdall image &#39;lscr.io/linuxserver/heimdall:latest&#39;
set container name heimdall network ct-network address &#39;172.23.0.2&#39;
set container name heimdall port http destination &#39;80&#39;
set container name heimdall port http source &#39;8033&#39;
set container name heimdall port https destination &#39;443&#39;
set container name heimdall port https source &#39;4432&#39;
set container name heimdall restart &#39;always&#39;
set container name heimdall volume conf destination &#39;/config&#39;
set container name heimdall volume conf source &#39;/home/aki/container/heimdall&#39;
</code></pre><p>这里source是容器的挂载路径，destination是容器内的路径
vyos的容器网络, 不用映射端口到主机, 就可以使用全端口, 当然你想映射, 也行</p>
<ol start="4">
<li>保存配置</li>
</ol>
<pre tabindex="0"><code>commit
</code></pre><p>注意!!!
如vyos的防火墙中设置了下面这条全局规则, 经测验会阻止容器的访问:</p>
<pre tabindex="0"><code>set firewall global-options state-policy invalid action &#39;drop&#39;
</code></pre><p>为此, 需要另外添加一条全局规则, 允许容器的流量:</p>
<pre tabindex="0"><code>set firewall global-options apply-to-bridged-traffic invalid-connections
</code></pre><ul class="pa0">
  
   <li class="list di">
     <a href="/blog/tags/vyos/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Vyos</a>
   </li>
  
   <li class="list di">
     <a href="/blog/tags/router/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Router</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://dsunn.github.io/blog/" >
    &copy;  Whatever blog 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
