<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ddns on Whatever blog</title>
    <link>https://dsunn.github.io/blog/tags/ddns/</link>
    <description>Recent content in Ddns on Whatever blog</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 05 Mar 2024 07:33:25 -0500</lastBuildDate>
    <atom:link href="https://dsunn.github.io/blog/tags/ddns/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>cloudflare ddns的routeros脚本</title>
      <link>https://dsunn.github.io/blog/post/mikrotik_cf_ddns/</link>
      <pubDate>Tue, 05 Mar 2024 07:33:25 -0500</pubDate>
      <guid>https://dsunn.github.io/blog/post/mikrotik_cf_ddns/</guid>
      <description>&lt;p&gt;在参考了j大佬的&lt;a href=&#34;https://www.digs.eu.org/2024/01/04/ROS%20cloudflare%20DDNS%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC/&#34;&gt;博客&lt;/a&gt;和这位作者的&lt;a href=&#34;https://gist.githubusercontent.com/kolobus/18680f8fb01ce3003cb9a3f82c9d30e1/raw/cf8ecd84fc0e5dccb7298422c7d8c40410c345a3/cf-ddns.rsc&#34;&gt;脚本&lt;/a&gt;的脚本后, 魔改的.&lt;/p&gt;&#xA;&lt;p&gt;适用在cloudflare上更新ipv4和ipv6的动态ip; 和原作者不同的是, 我的脚本是直接从ros接口上取相应ip, 其实我这脚本是放在ppp profile-on up-script中, 在拨号完成后执行一次, 而不是定时反复执行, 故相应修改了代码.&lt;/p&gt;&#xA;&lt;p&gt;token, zone_id, record_id等请先行获取, 获取方法在前述j大佬博客中有所提及.&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# Cloudflare Dynamic DNS update script&#xA;# Required policy: read, write, test, policy&#xA;# Add this script to scheduler&#xA;# Install DigiCert root CA or disable check-certificate&#xA;# Modified from https://gist.github.com/kolobus/18680f8fb01ce3003cb9a3f82c9d30e1&#xA;# Configuration ---------------------------------------------------------------------&#xA;&#xA;:local TOKEN &amp;#34;&amp;#34;&#xA;&#xA;:local ZONEIDv6 &amp;#34;&amp;#34;&#xA;:local RECORDIDv6 &amp;#34;&amp;#34;&#xA;:local RECORDNAMEv6 &amp;#34;&amp;#34;&#xA;:local IP6NEW&#xA;&#xA;:local ZONEIDv4 &amp;#34;&amp;#34;&#xA;:local RECORDIDv4 &amp;#34;&amp;#34;&#xA;:local RECORDNAMEv4 &amp;#34;&amp;#34;&#xA;:local IP4NEW&#xA;&#xA;:local WANIF &amp;#34;&amp;#34;&#xA;&#xA;#------------------------------------------------------------------------------------&#xA;&#xA;&#xA;&#xA;&#xA;:if ([/interface get $WANIF value-name=running]) do={&#xA;&#xA;    # IPv6 check&#xA;&#xA;    :local &amp;#34;IP6NEW&amp;#34; [/ipv6/address get [:pick [find dynamic global interface=$WANIF] 0 ] address]&#xA;    :set &amp;#34;IP6NEW&amp;#34; [:pick $&amp;#34;IP6NEW&amp;#34; 0 [:find $&amp;#34;IP6NEW&amp;#34; &amp;#34;/&amp;#34;]]&#xA;&#xA;        :local url &amp;#34;https://api.cloudflare.com/client/v4/zones/$ZONEIDv6/dns_records/$RECORDIDv6/&amp;#34;&#xA;&#xA;        :local cfapi [/tool fetch http-method=put mode=https url=$url check-certificate=no output=user as-value \&#xA;            http-header-field=&amp;#34;Authorization: Bearer $TOKEN&amp;#34; \&#xA;            http-data=&amp;#34;{\&amp;#34;type\&amp;#34;:\&amp;#34;AAAA\&amp;#34;,\&amp;#34;name\&amp;#34;:\&amp;#34;$RECORDNAMEv6\&amp;#34;,\&amp;#34;content\&amp;#34;:\&amp;#34;$IP6NEW\&amp;#34;,\&amp;#34;ttl\&amp;#34;:120,\&amp;#34;proxied\&amp;#34;:false}&amp;#34;]&#xA;&#xA;        :log info &amp;#34;CF-DDNS: $RECORDNAMEv6 is now $IP6NEW&amp;#34;&#xA;&#xA;&#xA;   # IPv4 check&#xA;&#xA;    :local ipaddr [/ip address get [/ip address find interface=$WANIF] address]&#xA;    :set IP4NEW [:pick $ipaddr 0 ([len $ipaddr] -3)]&#xA;&#xA;        :local url &amp;#34;https://api.cloudflare.com/client/v4/zones/$ZONEIDv4/dns_records/$RECORDIDv4/&amp;#34;&#xA;&#xA;        :local cfapi [/tool fetch http-method=put mode=https url=$url check-certificate=no output=user as-value \&#xA;            http-header-field=&amp;#34;Authorization: Bearer $TOKEN&amp;#34; \&#xA;            http-data=&amp;#34;{\&amp;#34;type\&amp;#34;:\&amp;#34;A\&amp;#34;,\&amp;#34;name\&amp;#34;:\&amp;#34;$RECORDNAMEv4\&amp;#34;,\&amp;#34;content\&amp;#34;:\&amp;#34;$IP4NEW\&amp;#34;,\&amp;#34;ttl\&amp;#34;:120,\&amp;#34;proxied\&amp;#34;:false}&amp;#34;]&#xA;&#xA;        :log info &amp;#34;CF-DDNS: $RECORDNAMEv4 is now $IP4NEW&amp;#34;&#xA;&#xA;&#xA;} else={&#xA;&#xA;    :log info &amp;#34;CF-DDNS: $WANIF is not currently running, quitting&amp;#34;&#xA;&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
  </channel>
</rss>
